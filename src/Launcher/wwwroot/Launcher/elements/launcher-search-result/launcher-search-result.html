<link rel="import" href="/sys/polymer/polymer.html" />

<dom-module id="launcher-search-result">
    <style>
        :host {
            color: black;
        }

    </style>
    <template>

    </template>
    <script>
        Polymer({
            is: 'launcher-search-result',
            properties: {
                data: {
                    type: Object,
                    notify: true,
                },
                keypress: {
                   type: Number,
                   notify: true
                },
                types: {
                  type: Array,
                  value: [],
                }
            },
  		      observers: [
  			      'resultChanged(data.*)',
              'keyPressed(keypress)'
  		      ],
            ready: function () {
                this.data = this.data || {};
            },
            suggestionHovered: function (event, detail) {
              removeClass(Polymer.dom(this.$.result).querySelector('.item.active'), 'active');
              addClass(event.currentTarget, 'active');
            },
            resultChanged: function (d) {
              var types = [];
              for (var name in this.data)
              {
                if (this.data.hasOwnProperty(name) && this.data[name].hasOwnProperty("Types")) {
                  for (var i = 0; i < this.data[name].Types.length; i++) {
                    types.push(this.data[name].Types[i]);
                  }
                }
              }
              this.set('types', types);
            },
            itemTapped: function (event, detail, sender) {
              var item = Polymer.dom(this.$.result).querySelector('.item.active');
              if (item) {
                this.activateItem(item);
              }
            },
            activateNext: function () {
              var item = Polymer.dom(this.$.result).querySelector('.item.active');
              if (item) {
                var items = Polymer.dom(this.$.result).querySelectorAll('.item');
                for (var i = 0; i < items.length; i++) {
                  if (item == items[i]) {
                    if (items.length > i+1)
                    {
                      removeClass(item, 'active');
                      addClass(items[i+1], 'active');
                    }
                    return;
                  }
                }
              }
              else {
                var item =  Polymer.dom(this.$.result).querySelector('.item');
                if (item)
                  addClass(item, 'active');
              }
            },
            activatePrevious: function () {
              var item = Polymer.dom(this.$.result).querySelector('.item.active');
              if (item) {
                var items = Polymer.dom(this.$.result).querySelectorAll('.item');
                for (var i = 0; i < items.length; i++) {
                  if (item == items[i]) {
                    if (i > 0)
                    {
                      removeClass(item, 'active');
                      addClass(items[i-1], 'active');
                    }
                    return;
                  }
                }
              }
              else {
                var items =  Polymer.dom(this.$.result).querySelectorAll('.item');
                if (items.length > 0)
                  addClass(items[items.length-1], 'active');
              }
            },
            getName:function(obj) {
              for (var name in this.data)
              {
                if (this.data.hasOwnProperty(name) && (this.data[name] == obj))
                  return name;
              }
              return "";
            },
            keyPressed: function (key) {
                console.log(key);
                switch (key)
                {
                    case 38:
                        // up arrow
                        this.activatePrevious();
                        break;
                    case 40:
                        // down arrow
                        this.activateNext();
                        break;
                    case 13:
                        var item = Polymer.dom(this.$.result).querySelector('.item.active');
                        if (item) {
                          this.activateItem(item);
                        }
                        break;
                };
                this.keypress = 0;
            },
            activateItem: function(item)
            {
              var data = item._templateInstance.__data__.item;
              var number = data.Activate$;
              var itemIndex = data.$parent.indexOf(data);
              data = data.$parent.$parent;
              var typeIndex = data.$parent.indexOf(data);
              data = data.$parent.$parent;
              var appname = this.getName(data);
              var path = "data." + appname + ".Types.#" + typeIndex + ".Items.#" + itemIndex + ".Activate$";
              this.set(path, number + 1);
              console.log(path, number);
            },
            focus: function () {
                this.$.input.focus();
            },
            /*
            _computeClass: function (active) {
                return active ? 'active' : '';
            },
            _getTypes = function(data) {
              var items = [];
              for (var name in data)
              {
                if (data.hasOwnProperty(name) && data[name].hasOwnProperty("Types")) {
                   for (var i = 0; i < data[name].Types.length; i++) {
                     items.push(data[name].Items[i]);
                   }
                }
              }
              return items;
            }*/
        });
    </script>
</dom-module>
