<link rel="import" href="/sys/polymer/polymer.html">
<link rel="import" href="/sys/imported-template/imported-template.html">

<dom-module id="launcher-launchpad">
    <template>
        <style>
            .launchpad-tile a {
                text-align: center;
                min-width: 80px;
                display: block;
                text-align: center;
            }

            .launchpad-tile .launchpad-icon {
                padding: 8px;
                border-radius: 8px;
                display: block;
                min-height: 64px;
                font-size: 0px;
            }

            .launchpad-tile:hover .launchpad-icon {
                box-shadow: inset 0px 0px 10px rgba(138, 152, 176,0.8);
            }

            .launchpad-tile > a,
            .launchpad-tile:hover a {
                display: block;
                color: black;
                text-decoration: none;
            }

            .launchpad-tile h5 {
                text-align: center;
                margin: 2px;
                height: 14px;
                font-size: 13px;
                font-family: inherit;
                font-weight: normal;
                line-height: 1.1;
            }
        </style>
        <juicy-tiles-setup-sync api-url="/launcher/juicytilessetup"></juicy-tiles-setup-sync>
        <juicy-tile-grid defaulttilesetup='{ "height": 82, "width": 80 }' gutter="10" refreshonmutation>
            <template is="dom-repeat" items="{{appsArray}}">
                <div class="launchpad-tile">
                    <a href="{{getHref(item.name)}}">
                        <div class="launchpad-icon">
                            <template is="imported-template" content$="{{item.html}}"></template>
                        </div>
                        <h5 title="{{item.description}}">{{item.name}}</h5>
                    </a>
                </div>
            </template>
        </juicy-tile-grid>
    </template>
    <script>
        Polymer({
            is: "launcher-launchpad",
            properties: {
                apps: {
                    type: Object,
                    value: null,
                    observer: "appsChanged"
                },
                appsArray: {
                    type: Array,
                    value: []
                }
            },
            appsChanged: function (newVal, oldVal) {
                var array = [];

                for (var i in newVal) {
                    if (!Object.prototype.hasOwnProperty.call(newVal, i)) {
                        return;
                    }

                    var app = newVal[i];

                    if (app.name) {
                        array.push(app);
                    }
                }

                array.sort(function (a, b) {
                    var at = typeof a.sortNumber == "undefined" ? a.name : a.sortNumber;
                    var bt = typeof b.sortNumber == "undefined" ? b.name : b.sortNumber;

                    at = at.toString();
                    bt = bt.toString();

                    if (at < bt) {
                        return -1;
                    } else if (at > bt) {
                        return 1;
                    }

                    return 0;
                });

                this.set("appsArray", array);
            },
            getHref: function (name) {
                return "/" + name;
            }
        });
    </script>
</dom-module>