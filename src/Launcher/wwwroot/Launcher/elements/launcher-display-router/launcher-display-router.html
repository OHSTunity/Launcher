<script>
    /**
     * launcher-display-router 0.0.1
     * MIT license
     */
    (function(global) {

        var LauncherDisplayRoutePrototype = Object.create(HTMLElement.prototype);
        LauncherDisplayRoutePrototype.createdCallback = function() {
            var uri = window.location.pathname;

            Object.defineProperty(this, 'uri', {
                set: function(newVal) {
                    // do nothing if the value is the same
                    if(newVal === uri){
                        return false;
                    }
                    uri = newVal || window.location.pathname;
                    // console.log('set', this, uri);
                    // update disyaply when attached
                    if (this.isAttached) {
                        // console.log('update on change');
                        this.applyDisplaySelector();
                    }
                },
                get: function() {
                    return uri;
                }
            })
        };
        LauncherDisplayRoutePrototype.applyDisplaySelector = function() {
            var show = this.uri.match(this.matchPath)
            // console.log('apply', show);
            var selector = this.getAttribute('display-selector');
            if (selector) {
                var elem = null;

                try {
                    elem = document.querySelector(selector);
                } catch (ex) {}

                if (!elem) {
                    throw new Error("launcher-display-router: could not find any DOM element for given display-selector value: " + selector);
                }
                // console.log(show?'show':'hide', elem);
                if (show) {
                    elem.style.display = "";
                    elem.setAttribute("visible", "visible");
                    elem.dispatchEvent(new CustomEvent("resize", {
                        bubbles: false
                    }));
                } else {
                    elem.style.display = "none";
                    elem.removeAttribute("visible");
                }
            } else {
                throw new Error("launcher-display-router: display-selector cannot be empty");
            }
        };
        LauncherDisplayRoutePrototype.attributeChangedCallback = function(attributeName, oldVal, newVal) {
            if (attributeName == 'match-path') {
                this.matchPath = new RegExp(newVal, "i");
            } else if (attributeName === 'uri') {
                this.uri = newVal;
            }
        };
        LauncherDisplayRoutePrototype.attachedCallback = function() { //needs to be 'attached' not 'created', otherwise does not work with Polymer's TemplateBinding in attributes
            this.isAttached = true;
            // console.log('attached', this);
            this.attributeChangedCallback('match-path', '', this.getAttribute('match-path'));
            this.applyDisplaySelector();
        };
        LauncherDisplayRoutePrototype.detachedCallback = function() {
            this.isAttached = false;
        }

        document.registerElement('launcher-display-route', {
            prototype: LauncherDisplayRoutePrototype
        });
    })(window);
</script>
