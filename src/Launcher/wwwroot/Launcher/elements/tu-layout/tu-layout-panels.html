<!--


-->
<link rel="import" href="/sys/polymer/polymer.html">
<dom-module id="tu-layout-panels">
    <template>
        <style>
            :host{
              position: absolute;
              left: 0px;
              right: 0px;
              top: 0px;
              bottom: 0px;
              display: block;
            }

            :host #wrapper {
              display: flex;
              flex-direction: row;
              height: 100%;
              background-color: #ffffff;
            }
            :host #center
            {
              flex: 1 1 ;
              order: 2;
              z-index: 1;
              position: relative;
            }

            :host #context
            {
              position: relative;
              order: 1;
              z-index: 2;
              background: #fff;
              border-right: solid 1px #aaa;
              padding-top: 30px;
            }

            :host(.tu-layout-panels-left-close) #context tu-icon-button.toggler
            {
              transform: rotate(180deg);
            }

            :host(.tu-layout-panels-right-close) #right
            {
              width: 0px;
              overflow: hidden;
              visibility: hidden;
            }

            :host #right
            {
              position: relative;
              width: 350px;
              padding-top: 30px;
              order: 3;
              z-index: 3;
              background: #fff;
              border-left: solid 1px #aaa;
            /*  will-change: transform;
              transition: transform ease-in-out 0s, width ease-in-out 0s, visibility 0s;*/
            }

            #right .toggler
            {
              position: absolute;
              right: 5px;
              top: 5px;
            }

            /* Media query states */
            :host(.tu-layout-panels-micro) #context
            {
              position: absolute;
              left: 0;
              top: 0;
              bottom: 0;
            }

            :host(.tu-layout-panels-small) #left
            {
              position: absolute;
              left: 0;
              top: 0;
              bottom: 0;
            }

            :host(.tu-layout-panels-micro) #center
            {
              margin-left: 50px;
            }

            :host(.tu-layout-panels-small) #center
            {
              margin-left: 50px;
            }

            :host(.tu-layout-panels-micro) #right
            {
              position:absolute;
              position: absolute;
              right: 0;
              top: 0;
              bottom: 0;
            }

            :host(.tu-layout-panels-small) #right
            {
              position: absolute;
              right: 0;
              top: 0;
              bottom: 0;
            }

            :host(.tu-layout-panels-medium)  #right
            {
              position: absolute;
              right: 0;
              top: 0;
              bottom: 0;
            }

            #widthtracker
            {
              position: absolute;
              height: 100%;
              top: 0px;
              right: 0px;
              min-width: 4px;
              background-color: black;
              background-image: repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px);
              opacity: .0;
              cursor: ew-resize;
            }


            tu-actionboard-sidebar:hover #widthtracker
            {
              opacity:.25;
            }

            #widthtracker:hover
            {
              opacity:.6 !important;
            }

            .widthtracking
            {
              opacity:.6 !important;
              /*min-width: 6px !important;*/
            }

        </style>
        <div id="wrapper" >

            <div id="center">
                <content select="[main]"></content>
            </div>
            <div id="context">
                <!--<tu-icon-button nohovereffect taptoggle="{{context}}" class="toggler" icon="arrow-left"></tu-icon-button>-->
                <content select="[context]"></content>
                <div id="widthtracker" on-track="contextWidthTrack"></div>
            </div>
            <div id="right">
                <tu-icon-button class="toggler" icon="times" on-tap="onCloseRightTapped" ></tu-icon-button>
                <content select="[right]"></content>
            </div>

            <iron-media-query query="(min-width: 0px ) and ( max-width: 400px)" query-matches="{{layoutMicro}}"></iron-media-query>
            <iron-media-query query="(min-width: 401px ) and ( max-width: 800px)" query-matches="{{layoutSmall}}"></iron-media-query>
            <iron-media-query query="(min-width: 801px)  and ( max-width: 1150px)" query-matches="{{layoutMedium}}"></iron-media-query>
            <iron-media-query query="(min-width: 1151px)" query-matches="{{layoutLarge}}"></iron-media-query>

        </div>
    </template>
    <script>
        var TuApp = Polymer({
            is: "tu-layout-panels",
          properties: {
            showContext: {
              type: Boolean,
              value: false,
              notify: true,
            },
            contextMinimized: {
              type: Boolean,
              value: false,
              notify: true,
            },
            contextWidth: {
              type: Number,
              value: 350,
              notify: true,
            },
            right: {
              type: Boolean,
              value: false,
              notify: true,
              reflectToAttribute: true,
              observer: 'rightChanged',
            },
            layoutMicro: {
              type: Boolean,
              value: false,
              notify: true,
              observer: 'mediaChange',
            },
            layoutSmall: {
              type: Boolean,
              value: false,
              notify: true,
              observer: 'mediaChange',
            },
            layoutMedium: {
              type: Boolean,
              value: false,
              notify: true,
              observer: 'mediaChange',
            },
            layoutLarge: {
              type: Boolean,
              value: true,
              notify: true,
              observer: 'mediaChange',
            },
          },
          observers: [
            'contextStatusChanged(showContext, contextWidth, contextMinimized)'
          ],
          ready: function() {
          },
          attached: function() {
            this.listen(this, "tu-pane", "onTuMenu");
            this.listen(this, "tu-menu", "onTuMenu");
            this.listen(this.$.right, "panel-command", "onRightChange");
            this.listen(this.$.context, "panel-command", "onContextChange");
          },
          detached: function() {
            this.unlisten(this, "tu-pane", "onTuMenu");
            this.unlisten(this, "tu-menu", "onTuMenu");
            this.unlisten(this.$.right, "panel-command", "onRightChange");
            this.unlisten(this.$.context, "panel-command", "onContextChange");
          },
          onRightChange: function(ev) {
            this.set("right", ev.detail.status == 'open');
          },
          onContextChange: function(ev) {
            this.set("showContext", ev.detail.status == 'open');
          },
          contextStatusChanged: function(e) {
            this.toggleClass('minimized', this.contextMinimized, this.$.context);
            this.toggleClass('hidden', !this.showContext, this.$.context);
            var width = this.contextWidth;
            if (this.showContext) {
              if (this.contextMinimized)
                width = '40px';
            }
            else {
              width = '0px';
            }
              this.$.context.style.width = width + 'px';
            var mviews = Polymer.dom(this.$.context).queryDistributedElements("tu-layout-multiview");
            for (var i = 0; i < mviews.length; i++)
              mviews[i].panelWidth = width;
          },
          contextWidthTrack: function(e) {
            e.cancelBubble=true
            e.stopPropagation();
            switch(e.detail.state) {
              case 'start':
                this.$.widthtracker.classList.add("widthtracking");
              break;
              case 'end':
                this.$.widthtracker.classList.remove("widthtracking");
              break;
            }
            var width = e.detail.x;
            if (width < 40)
              width = 40;
            if (width > 600)
              width = 600;
            this.set('contextWidth', width);
          },
          onCloseRightTapped: function(ev) {
            this.set("right", false);
            var mviews = Polymer.dom(this.$.right).queryDistributedElements("tu-layout-multiview");
            for (var i = 0; i < mviews.length; i++)
              mviews[i].deActivateAll();
          },
          rightChanged: function(e)
          {
            this.classList.toggle("tu-layout-panels-right-close", !this.right);
          },
          onTuPane: function(e)
          {
            this.classList.toggle("show_pane", e.detail.open);
          },
          onTuMenu: function(e)
          {
            var menu = e.target;
            if ( (this.layoutMicro || this.layoutSmall ) )
            {
              menu.collapse = ! menu.isForceOpen();
            }
            else
            {
              menu.collapse = menu.isForceClose();
            }
            this.classList.toggle("collapse_menu", menu.collapse);
          },
          mediaChange: function()
          {
            this.classList.toggle("tu-layout-panels-micro", this.layoutMicro);
            this.classList.toggle("tu-layout-panels-small", this.layoutSmall);
            this.classList.toggle("tu-layout-panels-medium", this.layoutMedium);
            this.classList.toggle("tu-layout-panels-large", this.layoutLarge);
          }
        });
    </script>
</dom-module>
