<!doctype html>
<head>
    <title>Tunity</title>

    <!-- Object.observe & Array.observe shims for IE and FF -->
    <script src="/sys/object.observe/dist/object-observe.js"></script>
    <script src="/sys/array.observe/array-observe.js"></script>

    <!-- Import Polymer platform -->
    <script src="/sys/webcomponentsjs/webcomponents.js"></script>
    <script>
        window.Polymer = window.Polymer || {};
        window.Polymer.dom = "shadow";
    </script>
    <link rel="import" href="/sys/polymer/polymer.html" />
    <link rel="import" href="/sys/paper-dialog/paper-dialog.html" />

    <!-- Import Starcounter specific components -->
    <link rel="import" href="/sys/starcounter.html" />
    <link rel="import" href="/sys/starcounter-debug-aid/src/starcounter-debug-aid.html" />

    <!-- Import our elements -->
    <link rel="import" href="/Launcher/elements/launcher-layout/launcher-main.html" />
    <link rel="import" href="/Launcher/elements/launcher-launchpad/launcher-launchpad.html" />
    <link rel="import" href="/Launcher/elements/launcher-hot-key/launcher-hot-key.html" />
    <link rel="import" href="/Launcher/elements/launcher-search-input/launcher-search-input.html" />
    <link rel="import" href="/Launcher/elements/launcher-menu/launcher-menu.html" />
    <link rel="import" href="/Launcher/elements/tu-logo-with-spinner/tu-logo-with-spinner.html" />
    <link rel="import" href="/Launcher/elements/launcher-display-router/launcher-display-router.html" />
	<link rel="import" href="/Launcher/elements/puppet-bind-notifier/puppet-bind-notifier.html" />
    <link rel="import" href="/sys/starcounter-include/starcounter-include.html" />

    <!-- Disable untill migrated to Polymer1 <link rel="import" href="/sys/console-log/console-log.html" /> -->

    <!-- Import other elements used in this document -->
    <link rel="import" href="/sys/iron-icons/iron-icons.html" />
    <link rel="import" href="/sys/paper-icon-button/paper-icon-button.html" />
    <!-- Disable untill migrated to Polymer1 <link rel="import" href="/sys/paper-toggle-button/paper-toggle-button.html" /> -->

    <link rel="import" href="/sys/imported-template/imported-template.html" />
	  <!--<link rel="import" href="/sys/dom-imported/dom-imported.html" />-->
    <link rel="import" href="/sys/dom-bind-notifier/dom-bind-notifier.html" />
    <link rel="import" href="/sys/juicy-tile-editor/src/juicy-tile-editor.html" />
    <link rel="import" href="/sys/juicy-redirect/src/juicy-redirect.html" />

    <!--<link href='http://fonts.googleapis.com/css?family=Lato&subset=latin,latin-ext' rel='stylesheet' type='text/css'>-->
    <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>


    <!-- Style sheets -->
    <!--<link rel="import" href="/sys/bootstrap.html" />-->
    <link rel="stylesheet" href="/Launcher/css/style.css" />

    <link rel="shortcut icon" href="/Launcher/favicon.ico" />
</head>
<body is="launcher-main">
    <template id="root-launcher-dom-bind" is="dom-bind">
        <template is="dom-if" restamp if="{{model.editingMode$}}">
            <div class="launcher-toolbar launcher-topbar">&nbsp;</div>
        </template>

        <div class="launcher-toolbar launcher-topbar">
            <div style="margin-left: 10px;min-width: 129px;max-width: 195px;">
                <tu-logo-with-spinner></tu-logo-with-spinner>
            </div>
            <div class="toolbar-padding"></div>
            <span class="toolbar-divider"></span>
            <div id="launcher-menu">
               <ul>
                  <template is="imported-template" content$="{{model.menu.Html}}" model="{{model.menu}}"></template>
               </ul>
            </div>
            <div flex=""></div>
            <span class="toolbar-divider"></span>
            <i class="ts_icon ts_icon_trello"></i>
            <!--<a href="/"><i id="homeIcon" class="glyphicon glyphicon-home"></i></a>-->
            <core-field class="launcher-theme">

                <launcher-search-input placeholder="Search here..." value="{{model.searchBar.query$}}" close-action="{{model.searchBar.close$}}" submit-action="{{model.searchBar.submit$}}"></launcher-search-input>
                <span style="padding-bottom: 5px;" id="search-icon"><i class="fa fa-search" style="font-size:0.70em;color:rgba(255,255,255,.5)"></i></span>

                <link is="juicy-redirect" history url="{{model.searchBar.searchEngineResultPageUrl$}}" />
                <template is="dom-if" if="{{model.searchBar.previewVisible}}">
                    <div class="preview">
                        <starcounter-include class="preview" partial="{{model.searchBar.preview}}"></starcounter-include>
                    </div>
                </template>
            </core-field>
            <span class="toolbar-divider"></span>

            <template is="imported-template" content$="{{model.user.Html}}" model="{{model.user}}"></template>

            <!--<core-icon-button id="account" icon="account"></core-icon-button>-->
            <!--
            <template is="dom-if" restamp if="{{!model.layoutModified$}}">
<<<<<<< HEAD
                <paper-icon-button id="Paper-icon-button1" active="{{model.editingMode$}}" icon="settings" on-click="toggleEditor"></paper-icon-button>
=======
                <paper-icon-button id="settings" active="{{model.editingMode$}}" src="/Launcher/images/layout-editor.svg" on-click="toggleEditor"></paper-icon-button>
>>>>>>> StarcounterSamples/master
            </template>
            <template is="dom-if" restamp if="{{model.layoutModified$}}">
                <paper-icon-button id="settings" active="{{model.editingMode$}}" src="/Launcher/images/layout-editor-unsaved.svg" on-click="toggleEditor" class="modified" title="You have unsaved layout changes on this page!"></paper-icon-button>
            </template>
<<<<<<< HEAD
            -->
            <a href="/launcher/settings"><img id="launcher-settings-icon" src="/Launcher/images/cog.svg" /></a>
        </div>


        <div id="launcher-content">
            <div class="launchpad">
                <template is="dom-if" if="{{model.launchpad}}">
                    <launcher-launchpad apps="{{model.launchpad.names}}" layout="{{model.launchpad.layout}}"></launcher-launchpad>
                </template>
                <!--<launcher-launchpad json="{{model.launchpad}}"></launcher-launchpad>-->

            </div>
            <launcher-display-route match-path="^\/$|\/launcher/?$" uri="{{model.uri}}" display-selector=".launchpad"></launcher-display-route>

            <!-- <starcounter-include class="workspace launcher" partial="{{currentPage}}"></starcounter-include> -->
            <!-- just "/" or whatever starting from "/launcher/.." except stuff starting from "/launcher/workspace" -->

            <!-- Dashboard/search results/settings -->
            <starcounter-include class="workspace launcher" name="/Launcher/currentPage" partial="{{model.currentPage}}"></starcounter-include>
            <!-- just "/" or whatever starting from "/launcher/.." except stuff starting from "/launcher/workspace" -->
            <launcher-display-route match-path="^\/launcher\/" uri="{{model.uri}}" display-selector=".workspace.launcher"></launcher-display-route>

            <!-- Workspaces -->
            <template is="dom-repeat" items="{{model.workspaces}}">
                <!-- - workspace -->
                <template is="dom-if" if="{{item.AppName}}">
                    <launcher-display-route match-path$="{{concat('^\/', item.AppName)}}" uri="{{model.uri}}" display-selector$="{{concat('.workspace.', item.AppName)}}"></launcher-display-route>
                    <starcounter-include class$="{{concat('workspace ', item.AppName)}}" partial="{{item}}"></starcounter-include>
                </template>
                <template is="dom-if" if="{{!item.AppName}}">
                    <div style="padding: 15px; font-weight:bold; color:red;">
                        <div>A workspace without AppName</div>
                        <div>{{item.Html}}</div>
                    </div>
                </template>
            </template>
        </div>

        <!-- TODO migrate this getModel -->
        <launcher-hot-key keys="Ctrl+E" on-keypress="toggleEditor"></launcher-hot-key>
        <launcher-hot-key keys="Esc" onkeypress="toggleEditor"></launcher-hot-key>
        <template is="dom-if" restamp if="{{model.editingMode$}}">
            <div id="elementSettings" class="launcher-topbar">
                <juicy-tile-editor selection-mode="true"
                                   tile-lists-selector="juicy-tile-list, juicy-tile-grid, launcher-launchpad::shadow > juicy-tile-grid"
                                   class="max-height"
                                   modified="{{model.layoutModified$}}"
                                   on-juicy-tile-editor-close="closeEditor"></juicy-tile-editor>
            </div>
        </template>

        <paper-dialog opened="{{model.ConnectionError}}" modal="true">
            <h4>Connection error</h4>
            <p>You have been disconnected from server. Please reload page.</p>
            <div class="buttons">
                <button class="btn btn-sm btn-default" dialog-dismiss>Close</button>
                <span>&nbsp;</span>
                <button class="btn btn-sm btn-primary" dialog-confirm onclick="window.location = window.location.href;">Reload</button>
            </div>
        </paper-dialog>

        <dom-bind-notifier path="model" observed-object="{{model}}" deep ref="root-launcher-dom-bind"></dom-bind-notifier>
    </template>
    <script>
        (function () {
            var script = document._currentScript || document.currentScript;
            var template = script.previousElementSibling;

            template.closeEditor = function () {
                template.set("model.editingMode$", false);
            };

            template.concat = function () {
                return Array.prototype.join.call(arguments, "");
            };

            template.toggleEditor = function () {
                template.set("model.editingMode$", !template.model.editingMode$);
            };
            /*
			template.addEventListener("model-changed", function (e) {
				console.log(e);
			});*/

            template.addEventListener("dom-change", function () {
                var puppet = document.querySelector("puppet-client");

                puppet.addEventListener("connectionerror", function (e) {
                    e.detail.handled = true;
                    template.set("model.ConnectionError", true);
                });
            });
        })();
    </script>

    <puppet-client ref="root-launcher-dom-bind"></puppet-client>
	  <!--<puppet-bind-notifier path="model" ref="root-launcher-dom-bind"></puppet-bind-notifier>-->
    <starcounter-debug-aid></starcounter-debug-aid>
    <script>
        var puppet = document.getElementsByTagName("puppet-client")[0];
    </script>

    <div class="css-grid-error-back"></div>
    <div class="css-grid-error">
        <h4>This app requires support for CSS Grid Layout in your web browser</h4>
        <p>It is a new CSS feature that is currently implemented in Google Chrome and Opera.</p>
        <p>To enable it in Google Chrome/Opera:</p>
        <ol>
            <li>Go to "chrome://flags"</li>
            <li>Search for "Enable experimental Web Platform features" option</li>
            <li>Press "Enable" link</li>
            <li>Restart Chrome/Opera</li>
        </ol>
        <p>
            We are working on extending support to all modern web browsers.
        </p>
    </div>
    <script>
        (function () {
            var div = document.createElement("div");

            div.style.display = "grid";

            if (div.style.display == "grid") {
                return;
            }

            div.style.display = "-ms-grid";

            if (div.style.display == "-ms-grid") {
                return;
            }

            document.querySelector(".css-grid-error-back").style.display = "block";
            document.querySelector(".css-grid-error").style.display = "block";
        })();
    </script>
</body>
