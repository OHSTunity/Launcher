<!doctype html>
<html>
<head>
    <title>Tunity</title>
    <script>
      /*
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-80047161-1', 'auto');
      ga('send', 'pageview');
      */

    (function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=e.createElement("script");a.type="text/javascript";a.async=!0;a.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f)}})(document,window.mixpanel||[]);
mixpanel.init("372a0f527e2227887404d5436c4ed866");


    mixpanel.track("Page reloaded");
    mixpanel.time_event("Page reloaded");

    </script>

    <!-- Import Polymer platform -->
    <script src="/sys/webcomponentsjs/webcomponents.js"></script>
    <script>
      window.Polymer = window.Polymer || {};
      window.Polymer.dom = "shadow";
      //Raven.config('https://25d8d13cb3474332b051f3a8c8c3e647@app.getsentry.com/65046').install();
    </script>
    

    <link rel="import" href="/sys/polymer/polymer.html" />


    <link rel="import" href="/sys/paper-dialog/paper-dialog.html" />

    <!-- Import Starcounter specific components -->
    <link rel="import" href="/sys/starcounter.html" />
    <link rel="import" href="/sys/starcounter-debug-aid/src/starcounter-debug-aid.html" />

    <!-- Import our elements -->
    <link rel="import" href="/Launcher/elements/launcher-launchpad/launcher-launchpad.html" />
    <link rel="import" href="/Launcher/elements/launcher-hot-key/launcher-hot-key.html" />
    <link rel="import" href="/Launcher/elements/launcher-search/launcher-search.html" />
    <link rel="import" href="/Launcher/elements/launcher-search-input/launcher-search-input.html" />
    <link rel="import" href="/Launcher/elements/launcher-search-result/launcher-search-result.html" />
    <link rel="import" href="/Launcher/elements/launcher-menu/launcher-menu.html" />
    <link rel="import" href="/Launcher/elements/tu-logo-with-spinner/tu-logo-with-spinner.html" />
    <link rel="import" href="/Launcher/elements/launcher-display-router/launcher-display-router.html" />
	  <link rel="import" href="/Launcher/elements/puppet-bind-notifier/puppet-bind-notifier.html" />
    <link rel="import" href="/sys/starcounter-include/starcounter-include.html" />
    <link rel="import" href="/Launcher/elements/tu-layout/tu-layout-panels.html" />
    <link rel="import" href="/Launcher/elements/tu-layout/tu-layout-multiview.html" />
    <!-- Disable untill migrated to Polymer1 <link rel="import" href="/sys/console-log/console-log.html" /> -->

    <!-- Import other elements used in this document -->
    <link rel="import" href="/sys/paper-icon-button/paper-icon-button.html" />
    <!-- Disable untill migrated to Polymer1 <link rel="import" href="/sys/paper-toggle-button/paper-toggle-button.html" /> -->

    <link rel="import" href="/sys/imported-template/imported-template.html" />
    <link rel="import" href="/sys/puppet-redirect/puppet-redirect.html" />


    <!--<link href='http://fonts.googleapis.com/css?family=Lato&subset=latin,latin-ext' rel='stylesheet' type='text/css'>-->
    <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
    <!--<link rel="stylesheet" type="text/css" href="/sys/font-awesome/css/font-awesome.css">-->
    <!--<link rel="stylesheet" href="/sys/font-awesome/css/font-awesome.css">-->
    <!-- Style sheets -->
    <!--<link rel="import" href="/sys/bootstrap.html" />-->
    <link rel="stylesheet" href="/Launcher/css/style.css" />

    <link rel="shortcut icon" href="/Launcher/favicon.ico" />
    <style>

        @element ".container" and (min-width: 160px) {
          .container {
            background: gold;
            border: 10px solid red;
          }
        }
        
    </style>
</head>
<body is="launcher-main" class="loading">
    <div id="tu-splash">
        <span id="tu-splash-text">LOADING</span>
        <span id="tu-splash-spinner">âš‡</span>
    </div>
    <template id="root-launcher-dom-bind" is="dom-bind">

        <div class="launcher-toolbar launcher-topbar">
            <div style="margin-left: 10px;min-width: 129px;max-width: 195px;">
                <tu-logo-with-spinner></tu-logo-with-spinner>
            </div>

            <div class="toolbar-padding"></div>
            <span class="toolbar-divider"></span>
            <div id="launcher-menu">
               <ul>
                  <template is="imported-template" content$="{{model.menu.LauncherLayoutInfo.MergedHtml}}" model="{{model.menu}}"></template>
               </ul>
            </div>
            <div flex=""></div>
            <span class="toolbar-divider"></span>
            <i class="ts_icon ts_icon_trello"></i>
            <!--<a href="/"><i id="homeIcon" class="glyphicon glyphicon-home"></i></a>-->
            <core-field class="launcher-theme">
              <launcher-search placeholder="Search here..."  data="{{model.searchBar}}"></launcher-search>
            </core-field>
            <span class="toolbar-divider"></span>

            <template is="imported-template" content$="{{model.user.LauncherLayoutInfo.MergedHtml}}" model="{{model.user}}"></template>

<!--
            <template is="dom-if" restamp if="{{!model.layoutModified$}}">
              <paper-icon-button id="settings" active="{{model.editingMode$}}" src="/Launcher/images/layout-editor.svg" toggles></paper-icon-button>
            </template>
            <template is="dom-if" restamp if="{{model.layoutModified$}}">
              <paper-icon-button id="settings" active="{{model.editingMode$}}" src="/Launcher/images/layout-editor-unsaved.svg" toggles class="modified" title="You have unsaved layout changes on this page!"></paper-icon-button>
            </template>-->

            <launcher-hot-key keys="Ctrl+E" on-keypress="toggleEditor"></launcher-hot-key>
            <launcher-hot-key keys="Esc" on-keypress="closeEditor"></launcher-hot-key>

            <!--<a href="/launcher/settings"><img id="launcher-settings-icon" src="/Launcher/images/cog.svg" /></a>
-->
        </div>

        <template is="dom-if" restamp if="{{model.editingMode$}}">
            <template is="imported-template" model="{{model}}" content="/Launcher/viewmodels/LayoutEditor.html"></template>
        </template>

        <div id="launcher-content">

            <tu-layout-panels>
              <div main>
                <div class="launchpad">
                    <template is="dom-if" if="{{model.launchpad}}">
                        <launcher-launchpad apps="{{model.launchpad.names}}" layout="{{model.launchpad.layout}}"></launcher-launchpad>
                    </template>
                    <!--<launcher-launchpad json="{{model.launchpad}}"></launcher-launchpad>-->

                </div>
                <launcher-display-route match-path="^\/$|^\/launcher/?$" uri="{{model.uri}}" display-selector=".launchpad"></launcher-display-route>

                  <!-- <starcounter-include class="workspace launcher" partial="{{currentPage}}"></starcounter-include> -->
                  <!-- just "/" or whatever starting from "/launcher/.." except stuff starting from "/launcher/workspace" -->

                  <!-- Dashboard/search results/settings -->
                  <starcounter-include class="workspace launcher" name="/Launcher/currentPage" partial="{{model.currentPage}}"></starcounter-include>
                  <!-- just "/" or whatever starting from "/launcher/.." except stuff starting from "/launcher/workspace" -->
                  <launcher-display-route match-path="^\/launcher\/" uri="{{model.uri}}" display-selector=".workspace.launcher"></launcher-display-route>

                  <template is="dom-repeat" items="{{model.workspaces}}">
                      <starcounter-include partial="{{item}}" class="workspace" visible$="{{item.Launcher.ActiveWorkspace}}"></starcounter-include>
                  </template>
              </div>
              <tu-layout-multiview context data="{{model.contextbar}}"></tu-layout-multiview>
              <tu-layout-multiview right data="{{model.sidebar}}"></tu-layout-multiview>
            </tu-layout-panels>
        </div>

        <!-- TODO migrate this getModel -->
        <launcher-hot-key keys="Ctrl+E" on-keypress="toggleEditor"></launcher-hot-key>
        <launcher-hot-key keys="Esc" onkeypress="toggleEditor"></launcher-hot-key>
        <template is="dom-if" restamp if="{{model.editingMode$}}">
            <div id="elementSettings" class="launcher-topbar">
                <template is="imported-template" model="{{model}}" content="/Launcher/viewmodels/LayoutEditor.html"></template>
            </div>
        </template>

        <tu-lightbox-popup></tu-lightbox-popup>

        <paper-dialog opened="{{model.ConnectionError}}" modal="true">
            <h4>Connection error</h4>
            <p>You have been disconnected from server. Please reload page.</p>
            <div class="buttons">
                <button class="btn btn-sm btn-default" dialog-dismiss>Close</button>
                <span>&nbsp;</span>
                <button class="btn btn-sm btn-primary" dialog-confirm onclick="window.location = window.location.href;">Reload</button>
            </div>
        </paper-dialog>
    </template>
    <script>
        (function () {
            var script = document._currentScript || document.currentScript;
            var template = script.previousElementSibling;

            template.closeEditor = function () {
                template.set("model.editingMode$", false);
            };

            template.concat = function () {
                return Array.prototype.join.call(arguments, "");
            };

            template.toggleEditor = function () {
              console.log('toggle');
                template.set("model.editingMode$", !template.model.editingMode$);
            };

            template._getSidebars = function(data) {
              var sidebars=[];
              for (var name in data)
              {
                if (data.hasOwnProperty(name) &&
                    data[name].hasOwnProperty("Active$")) {
                  sidebars.push(data[name]);
                }
              }
              return sidebars;
            }
      		/*	template.addEventListener("model-changed", function (e) {
      				console.log("lt", e);
      			});*/

            template.addEventListener("dom-change", function () {
                var puppet = document.querySelector("puppet-client");

                puppet.addEventListener("connectionerror", function (e) {
                    e.detail.handled = true;
                    template.set("model.ConnectionError", true);
                });
            });
        })();
    </script>

    <puppet-client ref="root-launcher-dom-bind"></puppet-client>
	  <!--<puppet-bind-notifier path="model" ref="root-launcher-dom-bind"></puppet-bind-notifier>-->
    <starcounter-debug-aid></starcounter-debug-aid>
    <script>
        var puppet = document.getElementsByTagName("puppet-client")[0];
    </script>
</body>
</html>
