<!doctype html>
<head>
    <title>Launcher</title>
    <!-- Import Polymer platform -->
    <script src="/sys/webcomponentsjs/webcomponents.js"></script>
    <link rel="import" href="/sys/polymer/polymer.html" />

    <!-- Import Starcounter specific components -->
    <link rel="import" href="/sys/starcounter.html" />
    <link rel="import" href="/sys/starcounter-debug-aid/src/starcounter-debug-aid.html" />

    <!-- Import our elements -->
    <link rel="import" href="/Launcher/elements/launcher-layout/launcher-main.html" />
    <link rel="import" href="/Launcher/elements/launcher-partial/launcher-partial.html" />
    <link rel="import" href="/Launcher/elements/launcher-partial/launcher-root-partial.html" />
    <link rel="import" href="/Launcher/elements/launcher-launchpad/launcher-launchpad.html" />
    <link rel="import" href="/Launcher/elements/launcher-hot-key/launcher-hot-key.html" />

    <link rel="import" href="/sys/console-log/console-log.html" />

    <!-- Import other elements used in this document -->
    <link rel="import" href="/sys/core-icon/core-icon.html" />
    <link rel="import" href="/sys/core-icon-button/core-icon-button.html" />
    <link rel="import" href="/sys/paper-toggle-button/paper-toggle-button.html" />
    <link rel="import" href="/sys/core-field/core-field.html" />

    <link rel="import" href="/sys/imported-template/imported-template.html" />
    <link rel="import" href="/sys/juicy-tile-editor/src/juicy-tile-editor.html" />
    <link rel="import" href="/sys/juicy-display-router/juicy-display-router.html" />
    <link rel="import" href="/sys/juicy-redirect/src/juicy-redirect.html" />

    <!-- Style sheets -->
    <link rel="import" href="/sys/bootstrap.html" />
    <link rel="stylesheet" href="/Launcher/css/style.css" />
</head>
<body is="launcher-main">
    <template id="root" bind>
        <launcher-hot-key keys="Ctrl+Z" onkeyup="getModel(this).editingMode$ = !getModel(this).editingMode$"></launcher-hot-key>
        <launcher-hot-key keys="Esc" onkeyup="getModel(this).editingMode$ = false"></launcher-hot-key>
        <template if="{{editingMode$}}">
            <div id="elementSettings" class="launcher-topbar">
                <juicy-tile-editor selectionmode watchedtagnames="['JUICY-TILE-LIST', 'JUICY-TILE-GRID']" class="max-height"></juicy-tile-editor>
            </div>
            <div class="launcher-toolbar launcher-topbar">&nbsp;</div>
        </template>

        <div class="launcher-toolbar launcher-topbar">
            <a href="/"><i id="homeIcon" class="glyphicon glyphicon-home"></i></a>
            <core-field class="launcher-theme">
                <i class="glyphicon glyphicon-search"></i>
                <input placeholder="Search" value="{{searchBar.query$}}" update-on="input" />
                <link is="juicy-redirect" history url="{{searchBar.searchEngineResultPageUrl$}}" />
            </core-field>
            <template is="imported-template" content="{{ user.Html }}" bind="{{user}}"></template>

            <!--<core-icon-button id="account" icon="account"></core-icon-button>-->
            <core-icon-button id="settings" active="{{editingMode$}}" icon="settings" onclick="getModel(this).editingMode$ = !getModel(this).editingMode$" ></core-icon-button>
        </div>

        <div id="launcher-menu">
            <ul>
                <template is="imported-template" content="{{ menu.Html }}" bind="{{ menu }}"></template>
            </ul>
        </div>

        <div id="launcher-content">
            <div class="launchpad">
                <h1>Launchpad</h1>
                <launcher-launchpad json="{{launchpad}}"></launcher-launchpad>
            </div>
            <juicy-display-route match-path="^\/$|\/launcher/?$" display-selector=".launchpad"></juicy-display-route>

            <!-- <launcher-root-partial -->
            <!-- class="workspace launcher" bind="{{ results }}"></launcher-root-partial> -->
            <!-- just "/" or whatever starting from "/launcher/.." except stuff starting from "/launcher/workspace" -->

            <!-- Dashboard/results -->
            <template bind="{{results}}">
                <launcher-root-partial class="workspace launcher" name="/Launcher/results"></launcher-root-partial>
            </template>
            <!-- just "/" or whatever starting from "/launcher/.." except stuff starting from "/launcher/workspace" -->
            <juicy-display-route match-path="^\/launcher\/" display-selector=".workspace.launcher"></juicy-display-route>

            <!-- Workspaces -->
            <template repeat="{{ workspaces }}">
                <!-- - workspace -->
                <juicy-display-route match-path="^\/{{Launcher.appName}}" display-selector=".workspace.{{Launcher.appName}}"></juicy-display-route>
                <launcher-root-partial class="workspace {{Launcher.appName}}"></launcher-root-partial>
            </template>
        </div>
    </template>
    <puppet-client ref="root"></puppet-client>
    <starcounter-debug-aid></starcounter-debug-aid>

    <!--<script>
        window.addEventListener("load", function () {
            console.log("load");
            document.addEventListener("scroll", function () {
                var div = document.getElementById("elementSettings");

                if (!div) {
                    return;
                }

                var h = div.offsetHeight;
                var doc = document.documentElement;
                var sidebar = document.querySelector("juicy-tile-editor").getSidebar();
                //var left = (window.pageXOffset || doc.scrollLeft) - (doc.clientLeft || 0);
                var top = (window.pageYOffset || doc.scrollTop) - (doc.clientTop || 0);

                if (top > 70) {
                    div.style.position = "fixed";
                    div.style.top = "0px";
                    div.style.left = "0px";
                    div.style.width = "100%";
                    document.querySelector("body").style.paddingTop = h + "px"
                } else {
                    div.style.position = "";
                    document.querySelector("body").style.paddingTop = "0px"
                }
            });
        });
    </script>-->
</body>
