<link rel="import" href="../../polymer/polymer.html" />
<link rel="import" href="../../core-icon/core-icon.html" />
<link rel="import" href="../../core-icon-button/core-icon-button.html" />
<link rel="import" href="juicy-toggle-icon-button.html" />
<!-- load default set -->
<link rel="import" href="../../core-icons/core-icons.html" />
<link rel="import" href="juicy-draggable.html" />

<polymer-element name="juicy-tile-tree" attributes="tree">
    <template>
        <style>
            :host {
                overflow: auto;
                height: calc(100% - 35px);
                position: relative;
                display: block;
                width: 100%;
            }

            ul {
                margin-top: 0px;
                list-style: none;
                padding: 0;
            }

            li {
                white-space: nowrap;
                position: relative;
            }

            .element-label {
                cursor: default;
                padding: 1px 4px 2px 4px;
                border-radius: 2px;
            }
            
            .element-label.highlight {
                background-color: #01629E;
                color: white;
            }
            
            .element-label span.txt {
                white-space: nowrap;
                position: relative;
            }
            

            core-icon-button, juicy-toggle-icon-button {
                line-height: 1em;
            }
            
            juicy-toggle-icon-button.expand {
                position: absolute;
                top: 6px;
                left: -17px;
            }

            core-icon[role=img] {
                height: 1em;
                width: 1em;
                padding: 1px;
            }

            juicy-toggle-icon-button /deep/ core-icon[role=img] {
                height: 1em;
                width: 1em;
            }

            .expand[checked] ~ ul {
                display: none;
            }

            .blurred {
                opacity: 0.5;
            }

            .drag-helper {
                display: none;
                background-color: #fff5bc;
                border: #ffd800;
                color: black;
                padding: 1px 4px;
                line-height: normal;
                opacity: 0.8;
            }

            .drag-helper.dragging {
                display: block;
            }

            juicy-draggable {
                cursor: move;
            }

            .drop-folder.drag-hover {
                background-color: #bdf337;
                padding: 5px;
                margin: -5px 0px -5px -5px;
                color: #404040;
            }

            .visibility {
                position: absolute;
                top: 4px;
                right: 4px;
                display: none;
                background-color: #252526;
                padding: 0px 2px 2px 2px;
                border-radius: 2px;
            }

            .visibility[checked] {
                display: block;
            }

            li:hover > .visibility {
                display: block;
            }
            
            
            /* indentation of tree levels */
            
            ul .element-label,
            ul .expand {
                padding-left: calc(1 * 14px + 6px);
            }
            
            ul ul .element-label,
            ul ul .expand {
                padding-left: calc(2 * 14px + 6px);
            }
            
            ul ul ul .element-label,
            ul ul ul .expand {
                padding-left: calc(3 * 14px + 6px);
            }
            
            ul ul ul ul .element-label,
            ul ul ul ul .expand {
                padding-left: calc(4 * 14px + 6px);
            }
            
            ul ul ul ul ul .element-label,
            ul ul ul ul ul .expand {
                padding-left: calc(5 * 14px + 6px);
            }
            
            ul ul ul ul ul ul .element-label,
            ul ul ul ul ul ul .expand {
                padding-left: calc(6 * 14px + 6px);
            }
            
            ul ul ul ul ul ul ul .element-label,
            ul ul ul ul ul ul ul .expand {
                padding-left: calc(7 * 14px + 6px);
            }
            
            ul ul ul ul ul ul ul ul .element-label,
            ul ul ul ul ul ul ul ul .expand {
                padding-left: calc(8 * 14px + 6px);
            }
            
            ul ul ul ul ul ul ul ul ul .element-label,
            ul ul ul ul ul ul ul ul ul .expand {
                padding-left: calc(9 * 14px + 6px);
            }
            
            ul ul ul ul ul ul ul ul ul ul .element-label,
            ul ul ul ul ul ul ul ul ul ul .expand {
                padding-left: calc(10 * 14px + 6px);
            }
            
            ul ul ul ul ul ul ul ul ul ul ul .element-label,
            ul ul ul ul ul ul ul ul ul ul ul .expand {
                padding-left: calc(11 * 14px + 6px);
            }
            
            ul ul ul ul ul ul ul ul ul ul ul ul .element-label,
            ul ul ul ul ul ul ul ul ul ul ul ul .expand {
                padding-left: calc(12 * 14px + 6px);
            }
            
            ul ul ul ul ul ul ul ul ul ul ul ul ul .element-label,
            ul ul ul ul ul ul ul ul ul ul ul ul ul .expand {
                padding-left: calc(13 * 14px + 6px);
            }
            
            ul ul ul ul ul ul ul ul ul ul ul ul ul ul .element-label,
            ul ul ul ul ul ul ul ul ul ul ul ul ul ul .expand {
                padding-left: calc(14 * 14px + 6px);
            }
            
            ul ul ul ul ul ul ul ul ul ul ul ul ul ul .element-label,
            ul ul ul ul ul ul ul ul ul ul ul ul ul ul .expand {
                padding-left: calc(15 * 14px + 6px);
            }
        </style>

        <ul id="root" on-mousedown="{{preventTextSelection}}">
            <template repeat="{{ tree as branch }}" id="recursive">
                <!-- branch -->
                <li>
                    <juicy-toggle-icon-button class="expand" iconOn="chevron-right" iconOff="expand-more"></juicy-toggle-icon-button
                    ><div on-tap="{{tapAction}}" on-mouseover="{{hoverAction}}" on-mouseout="{{blurAction}}" class="{{ branch | getBranchClassName }}"
                    title="{{ toRootName(branch.node) }}"
                    ><span class="txt"><core-icon icon="view-quilt" title="juicy-tile-list"></core-icon>{{ branch.node.setup.itemName || toRootName(branch.node) }}</span></div>

                    <ul class="branch">
                        <template repeat="{{ branch.node.setup.items as item }}" id="item">
                            <!-- item -->
                            <li class="drop">
                                <template if="{{ item.items }}">
                                    <!-- group -->
                  
                                    <juicy-toggle-icon-button class="expand" iconOn="chevron-right" iconOff="expand-more"></juicy-toggle-icon-button
                                    ><juicy-toggle-icon-button class="visibility" on-tap="{{ refreshTileList }}" iconOff="visibility" iconOn="visibility-off" checked="{{item.hidden}}"></juicy-toggle-icon-button
                                    ><juicy-draggable on-juicy-draggable-stop="{{ itemDragStop }}" position="static" dropselector="html /deep/ ul.branch li .drop-folder"
                                    ><div on-tap="{{tapAction}}" on-mouseover="{{hoverAction}}" on-mouseout="{{blurAction}}" class="{{ item | getBranchClassName }}" title="{{item.id}}"
                                    ><span class="txt"><core-icon class="drop-folder" icon="folder" title="group"></core-icon> {{ item.itemName || item.id }}</span></span></div></juicy-draggable>

                                    <ul class="group">
                                        <template repeat="{{ item.items as item }}" ref="item"></template>
                                    </ul>
                                </template>

                                <template if="{{ !item.items }}" id="element">
                                    <!-- real element -->
                  
                                    <template if="{{ !branch.branches[ item.id ] }}">
                                        <!-- without nested juicy-tile-list -->
                                        <juicy-toggle-icon-button class="visibility" on-tap="{{ refreshTileList }}" iconOff="visibility" iconOn="visibility-off" checked="{{item.hidden}}"></juicy-toggle-icon-button
                                        ><juicy-draggable on-juicy-draggable-stop="{{ itemDragStop }}" position="static" dropselector="html /deep/ ul.branch li .drop-folder"
                                        ><div on-tap="{{tapAction}}" on-mouseover="{{hoverAction}}" on-mouseout="{{blurAction}}" class="{{ item | getBranchClassName }}" title="{{item.id}}"
                                        ><span class="txt">{{ item.itemName || toDisplayName(item, branch) }}</span></div></juicy-draggable>
                                    </template>
                                    <template if="{{ branch.branches[ item.id ] }}">
                                        <!-- with nested juicy-tile-list -->
                                        <juicy-toggle-icon-button class="expand" iconOn="chevron-right" iconOff="expand-more"></juicy-toggle-icon-button
                                        ><juicy-toggle-icon-button class="visibility" on-tap="{{ refreshTileList }}" iconOff="visibility" iconOn="visibility-off" checked="{{item.hidden}}"></juicy-toggle-icon-button
                                        ><juicy-draggable on-juicy-draggable-stop="{{ itemDragStop }}" position="static" dropselector="html /deep/ ul.branch li .drop-folder"
                                        ><div on-tap="{{tapAction}}" on-mouseover="{{hoverAction}}" on-mouseout="{{blurAction}}" class="{{ item | getBranchClassName }}" title="{{item.id}}"
                                        ><span class="txt">⊛<!-- contains juicy-tile-list inside -->{{ item.itemName || toDisplayName(item, branch) }}</span></div></juicy-draggable>
                                        <ul class="group">
                                            <template repeat="{{ branch.branches[ item.id ] as branch }}" ref="recursive"></template>
                                        </ul>
                                    </template>
                                </template>
                            </li>
                        </template>
                    </ul>
                </li>
            </template>
        </ul>
        <shadow></shadow>
    </template>
    <script src="juicy-tile-tree.js"></script>
</polymer-element>