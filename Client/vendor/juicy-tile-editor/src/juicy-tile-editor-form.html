<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../core-selector/core-selector.html">
<link rel="import" href="../../juicy-popover/src/juicy-popover.html">
<link rel="import" href="juicy-color-picker.html">

<polymer-element name="juicy-tile-editor-form" attributes="selectedItems editedTiles">
  <template>
    <style>
      .editablesContainer {
        display: flex;
      }

      .editableGroup {
        flex: 1 1 auto;
        display: flex;
      }

      label {
        display: inline-block;
        white-space: nowrap;
      }

      .val {
        display: inline-block;
        width: 50px;
      }

      .toolbar-item[disabled],
      button[disabled],
      div[disabled]{
        opacity: 0.25;
        pointer-events: none;
      }

      button {
        min-height: 1.45em;
        min-width: 1.45em;
        display: inline-block;
        padding: 0 2px;
        margin: 0;
        vertical-align: top;
        line-height: 1;
        font-size: 14px;
        color: #243140;
        text-align: center;
        text-shadow: 0 1px rgba(255,255,255,0.2);
        background: #e5e7ed;
        border: 0;
        border-radius: 2px;
        cursor: pointer;
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
      }

      button:hover {
        color: #243140;
        background: #dcdfe7;
      }

      button:active,
      .expanded button.handle {
        color: #1d2938;
        background: #cdd1dc;
      }

      .expandable {
        background: #fff;
        border: 1px solid rgba(0, 0, 0, .2);
        box-shadow: 0 5px 10px rgba(0, 0, 0, .2);
        padding: 5px;
        max-width: 144px;
        white-space: normal;
      }
      .expandable.wide{
        width: auto;
        max-width: none;
      }

      .expandable textarea{
        width: 40em;
        height: 5em;
      }

      .sourceActions {
        text-align: right;
      }

      h4 {
        margin: 0;
        display: inline;
      }

      .toolbar-item {
        display: flex;
        flex-direction: column;
        margin-left: 10px;
      }

      .toolbar-item-wrapper {
        display: flex;
        flex-direction: column;
      }

      .toolbar-button {
        height: 20px;
        display: inline-block;
        white-space: nowrap;
        box-sizing: border-box;
      }

      .toolbar-button * {
        height: 20px;
        box-sizing: border-box;
      }

      .toolbar-button input{
        background-color: transparent;
      }

      .toolbar-button input{
        border: 1px solid #333;
      }

      .toolbar-button button{
        margin: 0 0 0 -1px;
      }

      .toolbar-button-background {
        background: white;
        border: 1px solid rgba(0, 0, 0, 0.1);
      }
      .toolbar-button.revert{
        transform: scale(1, -1);
      }

      .toolbar-label {
        font-size: 10px;
        text-align: center;
      }

      .sidebar {
        position: fixed;
        top: 150px;
        left: 10px;
        width: 200px;
        height: calc(100% - 160px);
        background: white;
        border: 1px solid black;
        opacity: 0.8;
        overflow: auto;
      }

      .sidebar /deep/ #menu {
        margin-left: 10px;
      }

      .button-column {
        display: flex;
        flex-direction: column;
      }

      .button-column button {
        margin-top: 4px;
      }

      .button-column button:first-child {
        margin-top: 0;
      }

      hr {
        border: 0;
        background-color: #ddd;
        height: 1px;
        margin: 10px 0;
      }
    </style>
    <div class="editablesContainer" on-click="{{applyChange}}" on-keyup="{{applyChange}}">
      <div class="editableGroup">
        <template if="{{editedTiles.sync}}">
          <div class="toolbar-item" disabled?="{{!modified}}">
            <button class="toolbar-button" on-click="{{saveChanges}}">✓</button>
            <label class="toolbar-label">Save</label>
          </div>

          <div class="toolbar-item" disabled?="{{!modified}}">
            <button class="toolbar-button revert" on-click="{{revertChanges}}">↩</button>
            <label class="toolbar-label">Revert</label>
          </div>
          <div class="toolbar-item">
            <button class="toolbar-button" on-click="{{clearConfig}}">✗</button>
            <label class="toolbar-label">Clear</label>
          </div>
        </template>

        <div class="toolbar-item">
          <juicy-popover>
            <button class="handle toolbar-button">{}</button>
            <div class="expandable wide">
              <textarea value="{{source}}"></textarea>
              <div class="sourceActions">
                <button class="editable" on-click="{{applySource}}">Apply</button>
              </div>
            </div>
          </juicy-popover>
          <label class="toolbar-label">Source</label>
        </div>

        <div class="toolbar-item" title="Supported only in juicy-tile-grid">
          <div class="toolbar-item-wrapper" disabled?="{{!isSelection || editedTiles.tagName != 'JUICY-TILE-GRID'}}">
            <juicy-popover>
              <button class="handle toolbar-button">⌗</button>
              <div class="expandable">
                <core-selector target="{{$.layoutForm}}" itemsSelector="input[type=radio]"
                               selected="{{layout}}" valueattr="value" selectedProperty="checked"
                               activateEvent="change"></core-selector>
                <form id="layoutForm">
                  <label><input type="radio" name="layout" value="absolute" on-click="{{applyLayout}}"> Absolute</label> <br>
                  <label><input type="radio" name="layout" value="grid" on-click="{{applyLayout}}"> Grid</label>
                </form>
              </div>
            </juicy-popover>
            <label class="toolbar-label">Layout</label>
          </div>
        </div>
      </div>

      <div class="editableGroup">
        <h4>Container</h4>

        <div class="toolbar-item" disabled?="{{!isContainer && !isRoot}}">
          <button class="toolbar-button" on-click="{{deleteContainer}}">⧉</button>
          <label class="toolbar-label">Ungroup</label>
        </div>

        <div class="toolbar-item" disabled?="{{!isContainer}}">
          <button class="toolbar-button" on-click="{{changeDirection}}">⤷/⤵</button>
          <label class="toolbar-label">Direction</label>
        </div>

        <div class="toolbar-item" disabled?="{{!isContainer}}">
          <button class="toolbar-button" on-click="{{stackItems}}">⇟</button>
          <label class="toolbar-label">Stack</label>
        </div>

        <div class="toolbar-item" disabled?="{{!isSelection}}" data-applyvalue="background">
          <juicy-popover>
            <button class="handle toolbar-button toolbar-button-background" style='background: {{background}}'>&nbsp;</button>
            <div class="expandable">
              <juicy-color-picker value="{{background}}" on-juicy-color-picker-value-changed="{{applyChange}}"></juicy-color-picker>
            </div>
          </juicy-popover>
          <label class="toolbar-label">Background</label>
        </div>

        <div class="toolbar-item" disabled?="{{!isContainer}}" data-applyvalue="gutter">
          <juicy-popover>
            <input class="handle toolbar-button val" placeholder="multiple" value="{{gutter | toNumber}}">
            <div class="expandable">
              <button class="editable" on-click="{{gutterIncrease}}">+</button>
              <button class="editable" on-click="{{gutterDecrease}}">-</button>
            </div>
          </juicy-popover>
          <label class="toolbar-label">Gap</label>
        </div>


        <div class="toolbar-item" title="Supported only for virtual groups in juicy-tile-list or in juicy-tile-grid with absolute layout.">
          <div class="toolbar-item-wrapper" disabled?="{{!isContainer || layout!='absolute'}}" data-applyvalue="oversize">
            <juicy-popover>
              <input class="handle toolbar-button val" placeholder="multiple" value="{{oversize}}">
              <div class="expandable">
                <button class="editable" on-click="{{oversizeIncrease}}">+</button>
                <button class="editable" on-click="{{oversizeDecrease}}">-</button>
              </div>
            </juicy-popover>
            <label class="toolbar-label">Oversize</label>
          </div>
        </div>

        <div class="toolbar-item" disabled?="{{!isSingleSelection}}" data-applyvalue="innerHTML">
          <juicy-popover>
            <button class="handle toolbar-button">✎</button>
            <div class="expandable wide">
              <textarea value="{{innerHTML}}"></textarea>
            </div>
          </juicy-popover>
          <label class="toolbar-label">Inner HTML</label>
        </div>
      </div>

      <div class="editableGroup">
        <h4>Selection</h4>

        <div class="toolbar-item" disabled?="{{!isSelection}}">
          <button class="toolbar-button" title="Move selected elements to the same group (CTRL+M)" on-click="{{moveSelectionToEditedItemContainer}}">⧉</button>
          <label class="toolbar-label">Move to group</label>
        </div>

        <div class="toolbar-item" disabled?="{{!isSelection}}">
          <button class="toolbar-button" title="Create a new group from selected elements (CTRL+G)" on-click="{{newGroupFromSelection}}">⧈</button>
          <label class="toolbar-label">New group</label>
        </div>

        <div class="toolbar-item" disabled?="{{!isSelection}}" data-applyvalue="width">
          <juicy-popover>
            <input placeholder="multiple" class="handle toolbar-button val" value="{{width}}" disabled?="{{widthAuto}}">
            <div class="expandable">
              <button class="editable" on-click="{{widthIncrease}}" disabled?="{{widthAuto}}">+</button>
              <button class="editable" on-click="{{widthDecrease}}" disabled?="{{widthAuto}}">-</button>
              <label class="editable"><input id="widthAutoCheckbox" type="checkbox" data-applyvalue="widthAuto" checked="{{widthAuto}}"> auto</label>
              <hr>
              <div class="button-column">
                <button value="100%" on-click="{{setValueFromButton}}" disabled?="{{widthAuto}}">100%</button>
                <button value="75%" on-click="{{setValueFromButton}}" disabled?="{{widthAuto}}">75%</button>
                <button value="50%" on-click="{{setValueFromButton}}" disabled?="{{widthAuto}}">50%</button>
                <button value="25%" on-click="{{setValueFromButton}}" disabled?="{{widthAuto}}">25%</button>
              </div>
            </div>
          </juicy-popover>
          <label class="toolbar-label">Width</label>
        </div>

        <div class="toolbar-item" disabled?="{{!isSelection}}" data-applyvalue="height">
          <juicy-popover>
            <input placeholder="multiple" class="handle toolbar-button val" value="{{height}}" disabled?="{{heightAuto}}">
            <div class="expandable">
              <button class="editable" on-click="{{heightIncrease}}" disabled?="{{heightAuto}}">+</button>
              <button class="editable" on-click="{{heightDecrease}}" disabled?="{{heightAuto}}">-</button>
              <label class="editable"><input id="heightAutoCheckbox" type="checkbox" data-applyvalue="heightAuto" checked="{{heightAuto}}"> auto</label>
              <div title="Supported only in juicy-tile-grid with grid layout.">
                <div 
                  disabled?="{{ editedTiles.tagName == 'JUICY-TILE-LIST' || layout=='absolute'}}">
                  <label class="editable"><input id="heightDynamicCheckbox" type="checkbox" data-applyvalue="heightDynamic" checked="{{heightDynamic}}"> dynamic</label>
                  <label class="editable"><input id="heightAdaptiveCheckbox" type="checkbox" data-applyvalue="heightAdaptive" checked="{{heightAdaptive}}"> adaptive</label>
                </div>
              </div>
              <hr>
              <div class="button-column">
                <button value="100%" on-click="{{setValueFromButton}}" disabled?="{{widthAuto}}">100%</button>
                <button value="75%" on-click="{{setValueFromButton}}" disabled?="{{widthAuto}}">75%</button>
                <button value="50%" on-click="{{setValueFromButton}}" disabled?="{{widthAuto}}">50%</button>
                <button value="25%" on-click="{{setValueFromButton}}" disabled?="{{widthAuto}}">25%</button>
              </div>
            </div>
          </juicy-popover>
          <label class="toolbar-label">Height</label>
        </div>

        <div class="toolbar-item" disabled?="{{!isSingleSelection}}" data-applyvalue="priority">
          <juicy-popover>
            <input class="handle toolbar-button val" value="{{priority}}" disabled>
            <div class="expandable">
              <button class="editable" on-click="{{priorityIncrease}}" disabled?="{{!isSingleSelection}}">+</button>
              <button class="editable" on-click="{{priorityDecrease}}" disabled?="{{!isSingleSelection}}">-</button>
            </div>
          </juicy-popover>
          <label class="toolbar-label">Priority</label>
        </div>
      </div>
    </div>
  </template>
  <script src="juicy-tile-editor-form.js"></script>
</polymer-element>