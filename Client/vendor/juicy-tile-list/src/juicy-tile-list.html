<!--
`juicy-tile-list element` - masonry-like Polymer Element for sortable tiles that packs efficiently without changing HTML structure (changes CSS only).

@elementjuicy-tile-list
@demo https://Juicy.github.io/juicy-tile-list/
-->
<!-- Import Polymer -->
<link rel="import" href="/vendor/polymer/polymer.html">

<!-- Define your custom element -->
<polymer-element name="juicy-tile-list" constructor="JuicyTileListElement" >
    <template>
    <style>
        :host {
            display: block;
            width: 100%;
        }
        #container{
            display: block;
            width: 100%;
        }
    </style>
    <div id="container"><content></content></div>
    </template>
    <script>
    (function( scope ){

        Polymer('juicy-tile-list', ( {
            domReady: function domReady(){
              var that = this;
              this.style.width = "100%";
              this.style.display = "block";

              window.addEventListener('resize', this.refresh.bind(this, null, null), true);

              this.refresh();


              // Observe changes
              // create an observer instance
              var observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                  if(mutation.addedNodes){
                      //DRY, performance
                      console.log("something was added, let's refresh")
                      that.refresh();
                  }
                });
              });
              // pass in the target node, as well as the observer options
              observer.observe(this, { childList: true });
              // end of: Observe changes
            },
            /**
             * Refresh everything
             */
          refresh: function( ) {
            console.info("My offsetWidth:", this.offsetWidth," it was me:", this);

            var container = this.$.container;
            var width = (this).offsetWidth;
            
            container.style.width = width + "px";
          }
         }) 
        );
    }());
    </script>

</polymer-element>
