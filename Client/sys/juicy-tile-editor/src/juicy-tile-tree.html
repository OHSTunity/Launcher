<link rel="import" href="../../polymer/polymer.html">

<polymer-element name="juicy-tile-tree" attributes="tree">
  <template>
    <style>
      ul {
        list-style: none;
        padding: 0 0 0 20px;
      }

      li span {
        cursor: default;
        white-space: nowrap;
      }

      li span.highlight {
        background-color: blue;
        color: white;
      }
    </style>

    <ul id="root" on-mousedown="{{preventTextSelection}}">
      <template repeat="{{ tree as branch }}" id="recursive">
        <!-- branch -->
        <li>
          <span on-tap="{{tapAction}}" class="{{ branch | getBranchClassName }}">⌗ {{ {node: branch.node}  | toDisplayName }} ▾</span>

          <ul class="branch">
            <template repeat="{{ branch.node.setup.items as item }}" id="item">
              <!-- item -->
              <li>
                <template if="{{ item.items }}">
                  <!-- group -->
                  <span on-tap="{{tapAction}}" class="{{ item | getBranchClassName }}">⊕ {{ {node: branch.node, item: item} | toDisplayName }} ▾</span>

                  <ul class="group">
                    <template repeat="{{ item.items as item }}" ref="item"></template>
                  </ul>
                </template>

                <template if="{{ !item.items }}" id="element">
                  <!-- real element -->

                  <template if="{{ !branch.branches[ item.index ] }}">
                    <!-- without nested juicy-tile-list -->

                    <span on-tap="{{tapAction}}" class="{{ item | getBranchClassName }}">{{ {node: branch.node, item: item} | toDisplayName }}</span>
                  </template>
                  <template if="{{ branch.branches[ item.index ] }}">
                    <!-- with nested juicy-tile-list -->
                    <span on-tap="{{tapAction}}" class="{{ item | getBranchClassName }}">⊛ {{ {node: branch.node, item: item} | toDisplayName }} ▾</span>

                    <ul class="group">
                      <template repeat="{{ branch.branches[ item.index ] as branch }}" ref="recursive"></template>
                    </ul>
                  </template>
                </template>
              </li>
            </template>
          </ul>
        </li>
      </template>
    </ul>

    <shadow></shadow>
  </template>
  <script src="juicy-tile-tree.js"></script>
</polymer-element>